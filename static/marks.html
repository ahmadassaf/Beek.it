<!DOCTYPE html>
<html>
<head>
    <link id="siteicon" rel="icon" href="./icon.png"/>
    <title>Demo Bookmark Window</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
    function onLoad() {
      $("#shared").text(location.search);
      socialMarkUpdate(true);
    }
    function socialMarkUpdate(isMarked) {
        var evt = document.createEvent("CustomEvent");
        evt.initCustomEvent("socialMarkUpdate", true, true, JSON.stringify({marked: isMarked}));
        document.documentElement.dispatchEvent(evt);
    }

    var shareData;
    addEventListener("OpenGraphData", function(e) {
      shareData = JSON.parse(e.detail);
      $.get("http://beek.it/api/addUrl", {url: shareData.url});
      $("#shared").text(shareData.url);
      $("#data").html(JSON.stringify(e.detail, undefined, 2));
      socialMarkUpdate(true);
    });
    </script>
</head>

<body onload="onLoad()" contentid="content">
  <div id="content">
    <h3>This window shares the url</h3>
    <div>Page Marked: <div id="shared" class="textbox"></div></div>
    <div>Data: <pre id="data" class="textbox"></pre></div>
    <button onclick="socialMarkUpdate(false); window.close()">Unmark</button>
    <button onclick="window.close();">Close</button>
  </div>
</body>
</html>
